# modeljs
> ç®€å•é«˜æ•ˆçš„ JS æ•°æ®æ¨¡å‹å®šä¹‰åº“ï¼Œå¸®åŠ©å‰åç«¯æ•°æ®ç»“æ„è½»æ¾è§£è€¦ï¼Œæé«˜ç¨‹åºå¥å£®æ€§ ğŸ’ªğŸ’ªğŸ’ª

![modeljs](./assets/modeljs.png)

# Intro
éšç€SPAåº”ç”¨çš„å…´èµ·ï¼Œå‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼å¤§è¡Œå…¶é“ï¼Œä½¿å¾—å‰åç«¯å„å¸å…¶èŒï¼Œå¤§å¤§å‡å°‘äº†æ²Ÿé€šåä½œæˆæœ¬ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹å‰ç«¯åªéœ€è°ƒç”¨åç«¯çš„æ¥å£å°†æ•°æ®ä½¿ç”¨åˆé€‚çš„æ–¹å¼ç›´æ¥å±•ç°å‡ºæ¥ï¼Œç„¶åæ¥å—ç”¨æˆ·è¾“å…¥ç›´æ¥è°ƒç”¨æ¥å£ä¼ å…¥åç«¯ã€‚è¿™ç§æ–¹å¼åœ¨å‚ä¸äººæ•°å°‘çš„ä¸­å°å‹é¡¹ç›®å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œæ¨¡å—è¶Šæ¥è¶Šå¤æ‚ï¼Œå‚ä¸äººå‘˜ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œå‰ç«¯çš„åŒ¿åä¸šåŠ¡å¯¹è±¡ä½¿å¾—åº”ç”¨å†…æµè½¬çš„æ•°æ®å¤„äºä¸€ç§ä¸é€æ˜çš„çŠ¶æ€ï¼Œç¨æœ‰ä¸æ…å°±å¯èƒ½å¼•å‘ç¨‹åºå´©æºƒï¼ŒåŒæ—¶åç«¯åœ¨æ¥å£å±‚é¢çš„è€¦åˆä¹Ÿä½¿å¾—æ¥å£çš„å˜æ›´å¯¹å‰ç«¯çš„å½±å“ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œé€ æˆäº†æ–°çš„åä½œæˆæœ¬ï¼Œå› æ­¤ä½¿ç”¨æ¨¡å‹åŒ–æ¥è§„èŒƒä¸šåŠ¡å¯¹è±¡å¯¹äºæŸäº›é¡¹ç›®æ¥è¯´å¾ˆæœ‰å¿…è¦ã€‚

* åŒ¿åä¸šåŠ¡å¯¹è±¡ä½¿å¾—åº”ç”¨å†…æµè½¬çš„æ•°æ®å¤„äºä¸€ç§ä¸é€æ˜çš„çŠ¶æ€ï¼Œç¨æœ‰ä¸æ…å°±å¯èƒ½å¼•å‘ç¨‹åºå´©æºƒ
* åŒ¿åä¸šåŠ¡å¯¹è±¡åœ¨ä¸åŒé¡µé¢éœ€è¦é‡æ–°å®šä¹‰ï¼Œä»£ç å¤ç”¨ç‡ä½ï¼Œä¸”æ ‡å‡†ä¸ç»Ÿä¸€
* å‰ç«¯ç›´æ¥ä½¿ç”¨æ¥å£æ•°æ®å¯¼è‡´æ¥å£å˜æ›´å¯¹å‰ç«¯å½±å“èŒƒå›´ä¸å¯æ§ï¼Œå¢åŠ äº†æ–°çš„åä½œæˆæœ¬
* ä¸ºäº†ä¿è¯ç¨‹åºå¥å£®æ€§ï¼Œå‰ç«¯ä¸å¾—ä¸åœ¨ä»»ä½•ç”¨åˆ°æ¥å£æ•°æ®çš„åœ°æ–¹ç¼–å†™æ›´å¤šæ— èŠçš„é˜²å¾¡æ€§ä»£ç 

modeljs æ˜¯ä¸€ä¸ªç®€å•é«˜æ•ˆçš„ JS æ•°æ®æ¨¡å‹å®šä¹‰åº“ï¼Œå¯ä»¥å¸®åŠ©å‰ç«¯è½»æ¾çš„å®šä¹‰å¥½åº”ç”¨ä¸šåŠ¡æ¨¡å‹ï¼ŒåŒæ—¶æä¾›ç®€æ´çš„ API æ¥è¿›è¡Œå‰åç«¯æ¥å£æ•°æ®åŒå‘æ˜ å°„ï¼Œä½¿å‰åç«¯åœ¨æ•°æ®ç»“æ„å±‚é¢è·å¾—ä¸€å®šç¨‹åº¦çš„è§£è€¦ï¼Œä»è€Œæé«˜ç¨‹åºå¯é æ€§ã€‚

# Featrues
- [x] è½»æ¾å®šä¹‰åº”ç”¨ä¸šåŠ¡æ¨¡å‹
- [x] æ”¯æŒåç«¯æ¥å£æ•°æ®åŒå‘æ˜ å°„
- [ ] æ”¯æŒéªŒè¯æ’ä»¶å¯¹æ¨¡å‹è¿›è¡Œæ•°æ®éªŒè¯

# Install
```
npm install modeljs-core --save
```

# Usage

##### æ¨¡å‹å®šä¹‰ï¼šUser.js
``` js
import Model from 'modeljs-core'
import http from 'axios'

// å®šä¹‰æ¨¡å‹
const User = Model.define('User', {
  id: {
    type: Number,
    field: 'uuid'           // æ¥å£å­—æ®µæ˜ å°„
    default: 0
  },
  name: {
    type: String,
    default: ''
  },
  companyName: {
    type: String,
    field: 'company.name',   // æ¥å£å­—æ®µæ˜ å°„
    default: ''
  }
})

// å¯ä½¿ç”¨åŸå‹æ‰©å±•è‡ªå®šä¹‰æ–¹æ³•
User.prototype.load = async function () {
  let { data } = await http.get({id: this.id})
  this.fromData(data)
  return this
}

User.prototype.save = async function () {
  let data = this.toData()
  return await http.post(data)
}

export default User
```

##### åŸºæœ¬ä½¿ç”¨
``` js
import User from './User'

// å®ä¾‹åŒ–
var user = new User({
    id: 100,
    name: 'Charles Lo',
    companyName: 'XXå…¬å¸'
})

console.log(user.id)            // 100
console.log(user.name)          // Charles Lo
console.log(user.companyName)   // XXå…¬å¸

// ä½¿ç”¨è‡ªå®šä¹‰æ–¹æ³•
var user = new User({ id: 101 })
await user.load()
console.log(user.name)          // å¼ ä¸‰

user.name = 'æå››'
await user.save()
```

##### æ¥å£æ•°æ®æ˜ å°„
``` js
import User from './User'

// å®ä¾‹åŒ–
var user = new User()

// æ­£å‘æ˜ å°„
var { data } = await http.get('/user/101')
// data çš„ç»“æ„ï¼š{ uuid: 101, name: 'å¼ ä¸‰', company: { name: 'å¼ ä¸‰çš„å…¬å¸' } }

user.fromData(data)

console.log(user.id)            // 101
console.log(user.name)          // å¼ ä¸‰
console.log(user.companyName)   // å¼ ä¸‰çš„å…¬å¸

// æ‰¹é‡æ­£å‘æ˜ å°„
var { data } = await http.get('/user/list')
// data çš„ç»“æ„ï¼š[{ uuid: 101, name: 'å¼ ä¸‰', company: { name: 'å¼ ä¸‰çš„å…¬å¸' } }, ...]

var users = User.fromDataSet(data)

console.log(users[0].id)            // 101
console.log(user[0].name)          // å¼ ä¸‰
console.log(user[0].companyName)   // å¼ ä¸‰çš„å…¬å¸

// åå‘æ˜ å°„
var user = new User({
    id: 101,
    name: 'å¼ ä¸‰',
    companyName: 'å¼ ä¸‰çš„å…¬å¸'
})

var data = user.toData()
// data çš„ç»“æ„ï¼š{ uuid: 101, name: 'å¼ ä¸‰', company: { name: 'å¼ ä¸‰çš„å…¬å¸' } }
await http.post('/user/save', data)

// æ‰¹é‡åå‘æ˜ å°„
var users = User.bulkCreate([{
    uuid: 101,
    name: 'å¼ ä¸‰',
    company: { id: 1, name: 'å¼ ä¸‰çš„å…¬å¸' }
}, {
    ...
}])

var data = User.toDataSet(users)
// data çš„ç»“æ„ï¼š[{ uuid: 100, name: 'Charles Lo', company: { id: 1, name: 'XXå…¬å¸' } }, ...]

await http.post('/user/addlist', data)

```

# API

``` js
import Model from 'modejs-core'

/**
 * å®‰è£…æ’ä»¶
 * @param  {Object} plugin      æ’ä»¶å¯¹è±¡
 * @param  {Object} options     æ’ä»¶é€‰é¡¹
 */
Model.use(plugn, options)

/**
 * å®šä¹‰æ¨¡å‹
 * @param  {String} name       æ¨¡å‹åç§°
 * @param  {Object} attributes æ¨¡å‹å®šä¹‰å¯¹è±¡
 * @return {Function}          æ¨¡å‹ç±»
 */
const ModelClass = Model.define(name, attributes)

/**
 * åˆ›å»ºæ¨¡å‹å¯¹è±¡
 * @param  {Object} values æ¨¡å‹å±æ€§å€¼
 * @return {Model}        æ¨¡å‹å¯¹è±¡
 */
var model = ModelClass.create(values)
// ç­‰åŒäº
var model = new ModelClass(values)

/**
 * æ‰¹é‡åˆ›å»ºæ¨¡å‹å¯¹è±¡
 * @param  {Array<Object>}  valueSets æ¨¡å‹å±æ€§å€¼é›†åˆ
 * @return {Array<Model>}             æ¨¡å‹é›†åˆ
 */
var models = ModelClass.bulkCreate(valueSets)

/**
 * ä» api æ•°æ®å¯¹è±¡è½¬æ¢ä¸ºæ¨¡å‹å¯¹è±¡
 * @param  {Object} data api æ•°æ®å¯¹è±¡
 * @return {Model}      æ¨¡å‹å¯¹è±¡
 */
model.fromData(data)
// ç­‰åŒäº
var model = ModelClass.fromData(data)

/**
 * å°†æ¨¡å‹å¯¹è±¡è½¬æ¢ä¸º api æ•°æ®å¯¹è±¡
 * @return {Object} api æ•°æ®å¯¹è±¡
 */
var data = model.toData()

/**
 * ä» api æ•°æ®å¯¹è±¡é›†åˆæ‰¹é‡åˆ›å»ºæ¨¡å‹å¯¹è±¡é›†åˆ
 * @param  {Array<Object>} data api æ•°æ®é›†åˆ
 * @return {Array<Model>}       æ¨¡å‹å¯¹è±¡é›†åˆ
 */
ModelClass.fromDataSet(dataSet)

/**
 * å°†æ¨¡å‹å¯¹è±¡é›†åˆæ‰¹é‡è½¬æ¢ä¸º api æ•°æ®å¯¹è±¡é›†åˆ
 * @param  {Array<Model>} models æ¨¡å‹å¯¹è±¡é›†åˆ
 * @return {Array<Object>}       api æ•°æ®é›†åˆ
 */
var dataSet = ModelClass.toDataSet(models)
```

![star](https://user-gold-cdn.xitu.io/2018/7/24/164ca9c0e943dcd7?w=240&h=240&f=png&s=41877)

å¦‚æœå¯¹ä½ æœ‰ç”¨ï¼Œæ¬¢è¿ star ^_^